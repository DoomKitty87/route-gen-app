<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="styles.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Seafoam</title>
    <script type="module" src="routegen.js" defer></script>
  </head>
  <body>
    <div class="navbar"> 
      <img class="icon" src="assets/seafoamarmadillo.webp">
      <h1 class="title">seafoam</h1>
      <div class="menubutton" onclick="resetMenu()"><h2 class="buttontext">GENERATE</h2></div>
      <div class="menubutton"><h2 class="buttontext">ROUTES</h2></div>
    </div>
    <div class="main">
      <div class="menua">
        <ul class="progressbar">
          <li class="progressitem" data-active="true">MAP ZONE<span class="dot" data-active="true"></span></li>
          <li class="progressitem" data-active="false">WAYPOINTS<span class="dot"></span></li>
          <li class="progressitem" data-active="false">SETTINGS<span class="dot" data-active="false"></span></li>
          <li class="progressitem" data-active="false">GENERATE<span class="dot" data-active="false"></span></li>
        </ul>
        <div class="menuscreen" id="menua1">
          <div class="infobox">
            <h1 class="infotitle">ROUTE AREA</h1>
            <h3 class="infodesc">Click to choose the area where your route will generate.</h3>
          </div>
          <div class="nextbutton">
            <h2 class="nextbuttontext" onclick="moveStep()">NEXT &#8594</h2>
          </div>
          <div class="mapbox">
            <img class="map" src="assets/map.png">
            <div class="xaxis">
              <div class="yaxis">
                <div class="mapsquare" id="20" onclick="setSquare(20)"></div>
                <div class="mapsquare" id="21" onclick="setSquare(21)"></div>
                <div class="mapsquare" id="22" onclick="setSquare(22)"></div>
                <div class="mapsquare" id="23" onclick="setSquare(23)"></div>
                <div class="mapsquare" id="24" onclick="setSquare(24)"></div>
              </div>
              <div class="yaxis">
                <div class="mapsquare" id="15" onclick="setSquare(15)"></div>
                <div class="mapsquare" id="16" onclick="setSquare(16)"></div>
                <div class="mapsquare" id="17" onclick="setSquare(17)"></div>
                <div class="mapsquare" id="18" onclick="setSquare(18)"></div>
                <div class="mapsquare" id="19" onclick="setSquare(19)"></div>
              </div>
              <div class="yaxis">
                <div class="mapsquare" id="10" onclick="setSquare(10)"></div>
                <div class="mapsquare" id="11" onclick="setSquare(11)"></div>
                <div class="mapsquare" style="opacity: 0"></div>
                <div class="mapsquare" id="13" onclick="setSquare(13)"></div>
                <div class="mapsquare" id="14" onclick="setSquare(14)"></div>
              </div>
              <div class="yaxis">
                <div class="mapsquare" id="5" onclick="setSquare(5)"></div>
                <div class="mapsquare" id="6" onclick="setSquare(6)"></div>
                <div class="mapsquare" id="7" onclick="setSquare(7)"></div>
                <div class="mapsquare" id="8" onclick="setSquare(8)"></div>
                <div class="mapsquare" id="9" onclick="setSquare(9)"></div>
              </div>
              <div class="yaxis">
                <div class="mapsquare" id="0" onclick="setSquare(0)"></div>
                <div class="mapsquare" id="1" onclick="setSquare(1)"></div>
                <div class="mapsquare" id="2" onclick="setSquare(2)"></div>
                <div class="mapsquare" id="3" onclick="setSquare(3)"></div>
                <div class="mapsquare" id="4" onclick="setSquare(4)"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="menuscreen" id="menua2">
          <div class="infobox">
            <h1 class="infotitle">WAYPOINTS</h1>
            <h3 class="infodesc">Enter desired waypoints- route may be +-10% of the value.</h3>
          </div>
          <div class="waypointentry">
            <form>
              <input id="wpform" class="waypointform" type="number" value="150">
            </form>
          </div>
          <div class="nextbutton">
            <h2 class="nextbuttontext" onclick="moveStep()">NEXT &#8594</h2>
          </div>
        </div>
        <div class="menuscreen" id="menua3">
          <div class="infobox">
            <h1 class="infotitle">SETTINGS</h1>
          </div>
          <div class="settingbox">
            <h2 class="settingdesc">Choose priority for teleport distance or density for route output.</h2>
            <form>
              <input class="priorityform" id="tp" type="radio" value="TP" name="priority">
              <label class="priorityform" for="tp">TP Distance</label>
              <br>
              <input class="priorityform" id="dens" type="radio" value="DENS" name="priority">
              <label class="priorityform" for="dens">Density</label>
            </form>
          </div>
          <div class="settingbox">
            <h2 class="settingdesc">Set allowed out of bounds range from the 8x8 chunk area (only use if you know what that means).</h2>
            <form>
              <input class="oobform" type="number" value="0">
            </form>
          </div>
          <div class="settingbox">
            <h2 class="settingdesc">Preference for approach/exit angle difference on a teleport pad.</h2>
            <form>
              <input class="angleenable" type="checkbox" id="anglecheck">
              <label class="angleenable" for="anglecheck">Enable</label>
              <br><br>
              <input class="anglesettings" type="number" value="0" id="angle22">
              <label class="anglesettings" for="angle22">2x2 Veins</label>
              <br><br>
              <input class="anglesettings" type="number" value="0" id="angle33">
              <label class="anglesettings" for="angle33">3x3 Veins</label>
            </form>
          </div>
          <div class="nextbutton" style="margin-top: 2rem">
            <h2 class="nextbuttontext" onclick="moveStep()">GENERATE</h2>
          </div>
        </div>
        <div class="menuscreen" id="menua4">
          <div class="infobox">
            <h1 class="infotitle">GENERATE</h1>
            <h3 class="infodesc">Your route is being generated. Please wait.</h3>
          </div>
          <div class="routeresults">
            <p class="routeoutput">Route loading...</p>
          </div>
        </div>
      </div>
    </div>
  <script>
    var activeSquare = -1;
    var currentStep = 1;

    var waypointNumber = 150;

    var priority = "tp";
    var allowedOOB = 0;

    var angleEnable = false;
    var angle22 = 0;
    var angle33 = 0;

    document.getElementById("menua1").style.opacity = 1;
    document.getElementById("menua1").style.display = "block";

    function setSquare(indx) {
      if (activeSquare != -1) {
        document.getElementById(activeSquare).style.backgroundColor = "#0e141b";
      }
      activeSquare = parseInt(indx);
      document.getElementById(indx).style.backgroundColor = "#ffffff";
    }
    async function getRoute() {
      var output = generateRoute(activeSquare, allowedOOB, priority, waypointNumber);
      //document.getElementsByClassName("routeoutput")[0].innerHTML = output[0];
    }
    async function resetMenu() {
      document.getElementById("menua" + (currentStep)).style.opacity = 0;
      document.getElementsByClassName("progressitem")[currentStep - 1].setAttribute("data-active", "false");
      document.getElementsByClassName("dot")[currentStep - 1].setAttribute("data-active", "false");
      await new Promise(r => setTimeout(r, 500)); 
      document.getElementById("menua" + (currentStep)).style.display = "none";
      currentStep = 1;
      document.getElementById(activeSquare).style.backgroundColor = "#0e141b";
      activeSquare = -1;
      document.getElementById("menua" + (currentStep)).style.display = "block";
      document.getElementById("menua" + (currentStep)).style.opacity = 1;
      document.getElementsByClassName("progressitem")[currentStep - 1].setAttribute("data-active", "true");
      document.getElementsByClassName("dot")[currentStep - 1].setAttribute("data-active", "true");
    }
    async function updateMenu(step) {
      document.getElementById("menua" + (step - 1)).style.opacity = 0;
      document.getElementsByClassName("progressitem")[step - 2].setAttribute("data-active", "false");
      document.getElementsByClassName("dot")[step - 2].setAttribute("data-active", "false");
      await new Promise(r => setTimeout(r, 500)); 
      document.getElementById("menua" + (step - 1)).style.display = "none";
      document.getElementById("menua" + (step)).style.display = "block";
      document.getElementById("menua" + (step)).style.opacity = 1;
      document.getElementsByClassName("progressitem")[step - 1].setAttribute("data-active", "true");
      document.getElementsByClassName("dot")[step - 1].setAttribute("data-active", "true");
      if (step == 4) getRoute();
    }
    function moveStep() {
      if (currentStep == 1 && activeSquare == -1) return;
      if (currentStep == 2) waypointNumber = document.getElementById("wpform").value;
      if (currentStep == 3) {
        if (document.getElementById("tp").checked) priority = "tp"; else priority = "dens";
        allowedOOB = document.getElementsByClassName("oobform")[0].value;
        if (document.getElementById("anglecheck").checked) {
          angleEnable = true; 
          angle22 = document.getElementsById("angle22").value;
          angle33 = document.getElementsById("angle33").value;
        } else angleEnable = false;
      }
      if (currentStep == 4) return;
      currentStep++;
      updateMenu(currentStep);
    }
  </script>
  </body>
</html>
